{% extends 'base.html' %}
{% block title %}회원가입승인{% endblock %}
{% block content %}
<div class="mb-3">
  <a href="{{ url_for('admin_home') }}" class="btn btn-outline-primary">관리자페이지로</a>
</div>

<div class="card">
  <div class="card-body">
    <div class="scroll-x">
      <table class="table table-bordered table-sm sticky-header" style="min-width:1400px">
        <thead>
          <tr>
            <th>순</th>
            <th>상사명</th>
            <th>주소</th>
            <th>사업자번호</th>
            <th>법인번호</th>
            <th>대표자</th>
            <th>연락처</th>
            <th>휴대폰</th>
            <th>이메일</th>
            <th>승인</th>
            <th>비고</th>
            <th>작업</th>
          </tr>
        </thead>
        <tbody>
        {% for m in members %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>
              {% if edit_id == m.id|string %}
                <input type="text" name="company_name" class="form-control form-control-sm" value="{{ m.company_name }}" form="edit_form_{{ m.id }}">
              {% else %}
                {{ m.company_name }}
              {% endif %}
            </td>
            <td>
              {% if edit_id == m.id|string %}
                <input type="text" name="address" class="form-control form-control-sm" value="{{ m.address or '' }}" form="edit_form_{{ m.id }}">
              {% else %}
                {{ m.address or '' }}
              {% endif %}
            </td>
            <td>{{ m.business_number }}</td>
            <td>
              {% if edit_id == m.id|string %}
                <input type="text" name="corporation_number" class="form-control form-control-sm" value="{{ m.corporation_number or '' }}" form="edit_form_{{ m.id }}">
              {% else %}
                {{ m.corporation_number or '' }}
              {% endif %}
            </td>
            <td>
              {% if edit_id == m.id|string %}
                <input type="text" name="representative" class="form-control form-control-sm" value="{{ m.representative or '' }}" form="edit_form_{{ m.id }}">
              {% else %}
                {{ m.representative or '' }}
              {% endif %}
            </td>
            <td>
              {% if edit_id == m.id|string %}
                <input type="text" name="phone" class="form-control form-control-sm" value="{{ m.phone or '' }}" form="edit_form_{{ m.id }}">
              {% else %}
                {{ m.phone or '' }}
              {% endif %}
            </td>
            <td>
              {% if edit_id == m.id|string %}
                <input type="text" name="mobile" class="form-control form-control-sm" value="{{ m.mobile or '' }}" form="edit_form_{{ m.id }}">
              {% else %}
                {{ m.mobile or '' }}
              {% endif %}
            </td>
            <td>
              {% if edit_id == m.id|string %}
                <input type="email" name="email" class="form-control form-control-sm" value="{{ m.email or '' }}" form="edit_form_{{ m.id }}">
              {% else %}
                {{ m.email or '' }}
              {% endif %}
            </td>
            <td>
              {% if edit_id == m.id|string %}
                <select name="approval_status" class="form-select form-select-sm" form="edit_form_{{ m.id }}">
                  <option value="신청" {% if m.approval_status == '신청' %}selected{% endif %}>신청</option>
                  <option value="승인중" {% if m.approval_status == '승인중' %}selected{% endif %}>승인중</option>
                  <option value="승인" {% if m.approval_status == '승인' %}selected{% endif %}>승인</option>
                </select>
              {% else %}
                <form method="post" class="d-inline">
                  <input type="hidden" name="member_id" value="{{ m.id }}">
                  <select name="approval_status" class="form-select form-select-sm" onchange="this.form.submit()">
                    <option value="신청" {% if m.approval_status == '신청' %}selected{% endif %}>신청</option>
                    <option value="승인중" {% if m.approval_status == '승인중' %}selected{% endif %}>승인중</option>
                    <option value="승인" {% if m.approval_status == '승인' %}selected{% endif %}>승인</option>
                  </select>
                  <input type="hidden" name="action" value="update_status">
                </form>
              {% endif %}
            </td>
            <td>
              {% if edit_id == m.id|string %}
                <input type="text" name="memo" class="form-control form-control-sm" value="" form="edit_form_{{ m.id }}" placeholder="비고 입력">
              {% else %}
                <input type="text" name="memo" class="form-control form-control-sm" value="" placeholder="비고 입력" readonly style="background-color: #f8f9fa;">
              {% endif %}
            </td>
            <td>
              {% if edit_id == m.id|string %}
                <form id="edit_form_{{ m.id }}" method="post" class="d-inline">
                  <input type="hidden" name="member_id" value="{{ m.id }}">
                  <input type="hidden" name="action" value="save">
                  <button class="btn btn-sm btn-success" type="submit">저장</button>
                  <a href="{{ url_for('admin_members') }}" class="btn btn-sm btn-secondary">취소</a>
                </form>
              {% else %}
                <a href="{{ url_for('admin_members', edit_id=m.id) }}" class="btn btn-sm btn-primary">수정</a>
                <form method="post" class="d-inline" onsubmit="return confirm('삭제하시겠습니까?')">
                  <input type="hidden" name="member_id" value="{{ m.id }}">
                  <input type="hidden" name="action" value="delete">
                  <button class="btn btn-sm btn-danger" type="submit">삭제</button>
                </form>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}


