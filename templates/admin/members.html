{% extends 'base.html' %}
{% block title %}회원가입승인{% endblock %}
{% block content %}
<div class="mb-4 flex flex-wrap gap-2 items-center">
  <a href="{{ url_for('admin_home') }}" class="inline-flex items-center px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors duration-200"><i class="bi bi-arrow-left mr-2"></i>관리자페이지로</a>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
  <div class="bg-white shadow-md rounded-lg p-4">
    <h5 class="text-lg font-semibold text-gray-800 mb-3">회원추가</h5>
    <form method="post" class="grid grid-cols-1 md:grid-cols-2 gap-3">
      <input type="hidden" name="action" value="create">
      <div>
        <label class="block text-sm text-gray-700 font-semibold mb-1">아이디<span class="text-red-500">*</span></label>
        <input type="text" name="username" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
      </div>
      <div>
        <label class="block text-sm text-gray-700 font-semibold mb-1">비밀번호</label>
        <input type="text" name="password" placeholder="미입력시 temp1234" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
      </div>
      <div>
        <label class="block text-sm text-gray-700 font-semibold mb-1">상사명<span class="text-red-500">*</span></label>
        <input type="text" name="company_name" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
      </div>
      <div>
        <label class="block text-sm text-gray-700 font-semibold mb-1">사업자번호<span class="text-red-500">*</span></label>
        <input type="text" name="business_number" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
      </div>
      <div>
        <label class="block text-sm text-gray-700 font-semibold mb-1">주소</label>
        <input type="text" name="address" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
      </div>
      <div>
        <label class="block text-sm text-gray-700 font-semibold mb-1">법인번호</label>
        <input type="text" name="corporation_number" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
      </div>
      <div>
        <label class="block text-sm text-gray-700 font-semibold mb-1">대표자</label>
        <input type="text" name="representative" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
      </div>
      <div>
        <label class="block text-sm text-gray-700 font-semibold mb-1">연락처</label>
        <input type="text" name="phone" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
      </div>
      <div>
        <label class="block text-sm text-gray-700 font-semibold mb-1">휴대폰</label>
        <input type="text" name="mobile" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
      </div>
      <div>
        <label class="block text-sm text-gray-700 font-semibold mb-1">이메일</label>
        <input type="email" name="email" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
      </div>
      <div>
        <label class="block text-sm text-gray-700 font-semibold mb-1">승인상태</label>
        <select name="approval_status" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
          <option value="신청">신청</option>
          <option value="승인중">승인중</option>
          <option value="승인" selected>승인</option>
        </select>
      </div>
      <div class="md:col-span-2 flex justify-end">
        <button class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">회원추가</button>
      </div>
    </form>
  </div>
  <div class="bg-white shadow-md rounded-lg p-4">
    <h5 class="text-lg font-semibold text-gray-800 mb-3">회원 일괄 업로드</h5>
    <div class="mb-2 text-sm text-gray-600">필수 컬럼: username, company_name, business_number / 선택 컬럼: password, address, corporation_number, representative, phone, mobile, email, approval_status</div>
    <form action="{{ url_for('admin_members_upload') }}" method="post" enctype="multipart/form-data" class="flex items-center gap-2">
      <input type="file" name="file" accept=".xlsx,.xls" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" required>
      <button class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">일괄업로드</button>
    </form>
  </div>
</div>

<div class="bg-white shadow-md rounded-lg p-6">
  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200 sticky-header table-auto">
      <thead class="bg-gray-50">
        <tr>
          <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">순</th>
          <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">상사명</th>
          <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">주소</th>
          <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">사업자번호</th>
          <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">법인번호</th>
          <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">대표자</th>
          <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">연락처</th>
          <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">휴대폰</th>
          <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">이메일</th>
          <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">승인</th>
          <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">비고</th>
          <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">작업</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        {% for m in members %}
          <tr>
            <td class="px-4 py-2 whitespace-nowrap">{{ loop.index }}</td>
            <td class="px-4 py-2 whitespace-nowrap">
              {% if edit_id == m.id|string %}
                <input type="text" name="company_name" class="form-input block w-full text-sm" value="{{ m.company_name }}" form="edit_form_{{ m.id }}">
              {% else %}
                {{ m.company_name }}
              {% endif %}
            </td>
            <td class="px-4 py-2 whitespace-nowrap">
              {% if edit_id == m.id|string %}
                <input type="text" name="address" class="form-input block w-full text-sm" value="{{ m.address or '' }}" form="edit_form_{{ m.id }}">
              {% else %}
                {{ m.address or '' }}
              {% endif %}
            </td>
            <td class="px-4 py-2 whitespace-nowrap">{{ m.business_number }}</td>
            <td class="px-4 py-2 whitespace-nowrap">
              {% if edit_id == m.id|string %}
                <input type="text" name="corporation_number" class="form-input block w-full text-sm" value="{{ m.corporation_number or '' }}" form="edit_form_{{ m.id }}">
              {% else %}
                {{ m.corporation_number or '' }}
              {% endif %}
            </td>
            <td class="px-4 py-2 whitespace-nowrap">
              {% if edit_id == m.id|string %}
                <input type="text" name="representative" class="form-input block w-full text-sm" value="{{ m.representative or '' }}" form="edit_form_{{ m.id }}">
              {% else %}
                {{ m.representative or '' }}
              {% endif %}
            </td>
            <td class="px-4 py-2 whitespace-nowrap">
              {% if edit_id == m.id|string %}
                <input type="text" name="phone" class="form-input block w-full text-sm" value="{{ m.phone or '' }}" form="edit_form_{{ m.id }}">
              {% else %}
                {{ m.phone or '' }}
              {% endif %}
            </td>
            <td class="px-4 py-2 whitespace-nowrap">
              {% if edit_id == m.id|string %}
                <input type="text" name="mobile" class="form-input block w-full text-sm" value="{{ m.mobile or '' }}" form="edit_form_{{ m.id }}">
              {% else %}
                {{ m.mobile or '' }}
              {% endif %}
            </td>
            <td class="px-4 py-2 whitespace-nowrap">
              {% if edit_id == m.id|string %}
                <input type="email" name="email" class="form-input block w-full text-sm" value="{{ m.email or '' }}" form="edit_form_{{ m.id }}">
              {% else %}
                {{ m.email or '' }}
              {% endif %}
            </td>
            <td class="px-4 py-2 whitespace-nowrap">
              {% if edit_id == m.id|string %}
                <select name="approval_status" class="form-select block w-full text-sm" form="edit_form_{{ m.id }}">
                  <option value="신청" {% if m.approval_status == '신청' %}selected{% endif %}>신청</option>
                  <option value="승인중" {% if m.approval_status == '승인중' %}selected{% endif %}>승인중</option>
                  <option value="승인" {% if m.approval_status == '승인' %}selected{% endif %}>승인</option>
                </select>
              {% else %}
                <form method="post" class="inline-block">
                  <input type="hidden" name="member_id" value="{{ m.id }}">
                  <select name="approval_status" class="form-select block w-full text-sm" onchange="this.form.submit()">
                    <option value="신청" {% if m.approval_status == '신청' %}selected{% endif %}>신청</option>
                    <option value="승인중" {% if m.approval_status == '승인중' %}selected{% endif %}>승인중</option>
                    <option value="승인" {% if m.approval_status == '승인' %}selected{% endif %}>승인</option>
                  </select>
                  <input type="hidden" name="action" value="update_status">
                </form>
              {% endif %}
            </td>
            <td class="px-4 py-2 whitespace-nowrap">
              {% if edit_id == m.id|string %}
                <input type="text" name="memo" class="form-input block w-full text-sm" value="" form="edit_form_{{ m.id }}" placeholder="비고 입력">
              {% else %}
                <input type="text" name="memo" class="form-input block w-full text-sm" value="" placeholder="비고 입력" readonly class="bg-gray-100 cursor-not-allowed">
              {% endif %}
            </td>
            <td class="px-4 py-2 whitespace-nowrap">
              {% if edit_id == m.id|string %}
                <form id="edit_form_{{ m.id }}" method="post" class="inline-flex space-x-2">
                  <input type="hidden" name="member_id" value="{{ m.id }}">
                  <input type="hidden" name="action" value="save">
                  <button class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">저장</button>
                  <a href="{{ url_for('admin_members') }}" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">취소</a>
                </form>
              {% else %}
                <a href="{{ url_for('admin_members', edit_id=m.id) }}" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">수정</a>
                <form method="post" class="inline-block ml-2" onsubmit="return confirm('삭제하시겠습니까?')">
                  <input type="hidden" name="member_id" value="{{ m.id }}">
                  <input type="hidden" name="action" value="delete">
                  <button class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">삭제</button>
                </form>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}


